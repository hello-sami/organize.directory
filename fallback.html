<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <meta name="description"
        content="Daily updates and resources for mutual aid networks and grassroots initiatives across different cities.">

    <meta name="color-scheme" content="light">
    <title>Page Helper - The Organize Directory</title>

    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Critical CSS -->
    <link rel="stylesheet" href="/styles.css?v=1.1.0">

    <!-- Non-blocking font loading -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Initialize Components Immediately -->
    <script type="module">
        import { initializeSidebar } from '/components/sidebar.js';

        // Initialize sidebar immediately
        initializeSidebar('home');
    </script>

    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            color: #4d0000;
            background-color: #fff5f5;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
        }

        .container {
            max-width: 600px;
            padding: 2rem;
            background: #ffd4d4;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(204, 0, 0, 0.2);
        }

        h1 {
            color: #800000;
            margin-bottom: 1rem;
        }

        p {
            margin-bottom: 1rem;
        }

        .loading {
            margin: 2rem 0;
        }

        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background: #a30000;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            margin-top: 1rem;
            font-weight: bold;
        }

        .btn:hover {
            background: #cc0000;
        }

        #debug {
            margin-top: 2rem;
            text-align: left;
            background: rgba(255, 255, 255, 0.5);
            padding: 1rem;
            border-radius: 4px;
            font-size: 0.9rem;
            white-space: pre-wrap;
        }
    </style>
    <meta property="og:image" content="https://organize.directory/preview.png">
</head>

<body>
    <div class="container">
        <h1>Finding your page...</h1>
        <p>We're redirecting you to the correct location.</p>
        <div class="loading">Loading...</div>
        <a href="/" class="btn">Return to Homepage</a>

        <div id="debug"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const debug = document.getElementById('debug');
            const path = window.location.pathname;
            let redirectPath = '';
            let debugInfo = 'URL Path: ' + path + '\n';

            // Check if this is a city page
            if (path.match(/^\/cities\/[^/]+\/?$/)) {
                const cityName = path.replace(/^\/cities\//, '').replace(/\/$/, '');
                redirectPath = '/cities/' + cityName + '.html';
                debugInfo += 'Detected as city page\n';
            }
            // Check if this is a state page
            else if (path.match(/^\/states\/[^/]+\/?$/)) {
                const stateName = path.replace(/^\/states\//, '').replace(/\/$/, '');
                redirectPath = '/states/' + stateName + '.html';
                debugInfo += 'Detected as state page\n';
            }
            // Check if this is a topic page
            else if (path.match(/^\/topics\/[^/]+\/?$/)) {
                const topicName = path.replace(/^\/topics\//, '').replace(/\/$/, '');
                redirectPath = '/topics/' + topicName + '.html';
                debugInfo += 'Detected as topic page\n';
            }
            // Check if this is a post page
            else if (path.match(/^\/posts\/[^/]+\/?$/)) {
                const postName = path.replace(/^\/posts\//, '').replace(/\/$/, '');
                redirectPath = '/posts/' + postName + '.html';
                debugInfo += 'Detected as post page\n';
            }
            // Check for main section pages
            else if (path.match(/^\/(location|topics|guides|contact|subscribe)\/?$/)) {
                const sectionName = path.replace(/^\//, '').replace(/\/$/, '');
                redirectPath = '/' + sectionName + '.html';
                debugInfo += 'Detected as section page\n';
            }

            if (redirectPath) {
                debugInfo += 'Redirecting to: ' + redirectPath;
                debug.textContent = debugInfo;

                // Redirect after a short delay
                setTimeout(function () {
                    window.location.href = redirectPath;
                }, 1500);
            } else {
                debugInfo += 'No matching pattern found\n';
                debug.textContent = debugInfo;
            }
        });
    </script>
</body>

</html>