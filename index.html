<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

    <!-- Preload critical resources -->
    <link rel="preload" href="/styles.css?v=1.1.9" as="style">
    <script>
        // Preload CSS to reduce flickering
        function preloadCriticalCSS() {
            const criticalStyles = ['/styles.css?v=1.1.9'];
            criticalStyles.forEach(href => {
                const link = document.createElement('link');
                link.rel = 'preload';
                link.href = href;
                link.as = 'style';
                document.head.appendChild(link);
            });
        }
        // Execute immediately
        preloadCriticalCSS();
    </script>

    <!-- Force mobile layout with inline CSS -->
    <!-- All styles have been moved to the external stylesheet for better maintenance -->

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <meta name="description"
        content="Daily updates and resources for mutual aid networks and grassroots initiatives across different cities.">

    <!-- Open Graph / Social Media -->
    <meta property="og:title" content="The Organize Directory">
    <meta property="og:description"
        content="Daily updates and resources for mutual aid networks and grassroots initiatives across different cities.">
    <meta property="og:image" content="https://organize.directory/preview.png">
    <meta property="og:url" content="https://organize.directory">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">

    <meta name="color-scheme" content="light">
    <title>Organize Directory - Find Local Action Groups</title>

    <!-- URL Normalizer - Reduces worker calls -->
    <script>
        // Simplified and optimized link handling
        document.addEventListener('click', function (e) {
            // Find clicked anchor element
            let anchor = e.target.closest('a');
            if (!anchor) return;

            // Only handle internal links
            let href = anchor.getAttribute('href');
            if (!href || href.startsWith('http') || href.startsWith('#')) return;

            // Handle trailing slashes consistently
            if (href.endsWith('/')) {
                href = href.slice(0, -1);
            }

            // Skip processing for root path
            if (href === '' || href === '/') return;

            // Combine conditional checks for better performance
            const needsHtml = !href.includes('.') && !href.includes('?');
            const isSpecialPath = href.match(/^\/(cities|states|topics|posts)\/[^/]+$/) && !href.endsWith('.html');

            if ((isSpecialPath || needsHtml) && !href.endsWith('.html')) {
                e.preventDefault();
                window.location.href = href + '.html';
            }
        });
    </script>

    <!-- Preconnect to external domains -->
    <link rel="stylesheet" href="/fonts/fonts.css">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">

    <!-- Critical CSS -->
    <link rel="stylesheet" href="/styles.css?v=1.1.9">

    <!-- Non-blocking font loading -->
    <link rel="stylesheet" href="/fonts/fonts.css">

    <!-- Mobile menu script - Load with defer to ensure it runs after DOM is ready -->
    <script src="/mobile-menu.js?v=1.0.1" defer></script>

    <!-- Initialize Components Immediately -->
    <script type="module">
        // Import sidebar as early as possible
        import('/components/sidebar.js?v=1.0.9')
            .then(module => {
                const { initializeSidebar, checkAndInitializeSidebar } = module;
                // Initialize sidebar with early detection
                checkAndInitializeSidebar('home');

                // Additional initialization can wait for DOMContentLoaded
                document.addEventListener('DOMContentLoaded', function () {
                    // Reset nav-group-title
                    const navGroupTitles = document.querySelectorAll('.nav-group-title');
                    navGroupTitles.forEach(title => {
                        title.classList.add('reset-nav-group');
                    });
                });
            })
            .catch(error => console.error('Error initializing sidebar:', error));

        // Initialize other components after DOM is loaded
        document.addEventListener('DOMContentLoaded', function () {
            import('/utils/init.js?v=1.0.1')
                .then(module => {
                    const { initializeComponents } = module;
                    initializeComponents({});
                })
                .catch(error => console.error('Error initializing components:', error));
        });
    </script>

    <!-- Include the title search script -->
    <script src="/js/title-search.js" defer></script>

    <!-- Mobile optimizations -->
    <script src="/js/mobile-optimizations.js" defer></script>
</head>

<body class="page-home">
    <div class="layout">
        <div id="sidebar-placeholder"></div>

        <main class="content" role="main">
            <header class="page-header"></header>

            <h1>The Organize Directory</h1>

            <!-- Add tagline -->
            <p class="tagline">An (incomplete) list of leftist and grassroots activist groups near and far.
                <strong>Don't despair, organize.</strong>
            </p>

            <div class="homepage-content">
                <!-- Remove duplicate search box -->

                <section class="find-groups-buttons">
                    <div class="buttons-container">
                        <a href="/location.html" class="find-groups-button primary-button">
                            <svg class="button-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            <span class="button-text">Find Local Groups</span>
                        </a>
                        <a href="/topics.html" class="find-groups-button secondary-button">
                            <svg class="button-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                            </svg>
                            <span class="button-text">Browse National Groups</span>
                        </a>
                    </div>
                </section>

                <section class="initiative-stats">
                    <div class="stats-container">
                        <div class="stat-item">
                            <span class="stat-number">2,466</span>
                            <span class="stat-label">GROUPS</span>
                            <span class="stat-mobile-label">GROUPS: 2,154</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">343</span>
                            <span class="stat-label">CITIES</span>
                            <span class="stat-mobile-label">CITIES: 343</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">41</span>
                            <span class="stat-label">CATEGORIES</span>
                            <span class="stat-mobile-label">CATEGORIES: 41</span>
                        </div>
                    </div>

                    <!-- Add context description -->
                    <p class="stats-description">
                    </p>
                </section>
            </div>

            <!-- Mobile responsiveness is now handled through CSS media queries in the external stylesheet -->

            <!-- <section class="daily-log" aria-labelledby="log-heading">
                <h2 id="log-heading">Calls to Action</h2>
                <div id="posts-list" class="posts-list">
                    <div class="loading-indicator">Loading posts...</div>
                </div>
            </section> -->
        </main>
    </div>

    <!-- Mobile menu overlay -->
    <div class="mobile-menu-overlay"></div>

    <!-- Mobile menu button -->
    <button class="mobile-menu-button" aria-label="Toggle navigation menu">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
    </button>
</body>

</html>